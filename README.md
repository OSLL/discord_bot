# DISCORD BOT 

Данный бот выполняет 3 функции:

- Выдача роли пользователю на основе реакции на некоторый пост в текстовом канале
- Удаление всех пользователей с определенной ролью
- Выдача роли пользователю при вхождении на канал

## Настройка бота на стороне discord
1. Для генерации ссылка для бота следует указать следующие права
    - Manage roles 
    - Kick members 
    - Read message/view channels
    - Send messages
2. В параметрах BOT/Privileged Gateway Intents указать
    - server members intent
    - message content intent

## Установка бота 

Склонируте репозиторий на хостинг 

## Настройка

Для работы бота нужно выполнить предварительную настройку: создать файл config.py в дирректории bot/ на основе config_example.py 

### Содержание файла config.py

1. TOKEN - токен полученный при создании бота.
2. GUILD - название сервера
3. ADMIN_ROLE - число; ID роли с правами администратора
4. ADMIN_CHANEL_ID - число; ID текстового канала который слушает бот для команды удаления.
5. PRIVEROLES - массив чисел; массив привилегированных ID ролей которые могут удалять пользователей через команду и не могут быть удалены через команду
6. DELETE_COMAND - строка; слово команда , с которой должно начинаться сообщение, чтобы удалить пользователей с определенной ролью
7. NEWUSERRILE_ID - число; ID роли которое нужно выдавать пользователю когда он входит на сервер
8. POST_ID - число; ID поста, на который нужно оставить реакцию, чтобы получить роль.
9. ROLES - словарь вида строка : число, где ключ это ID эмоции ( реакции ), а значение - это   ID роли, соответствующее этой реакции. 
10. EXCROLES - массив ID ролей; роли , которые не учитываются при подсчете количества ролей у пользователя.
11. MAX_ROLES_PER_USER - целое число; максимальное число ролей которое может быть у пользователя, исключая роли, описанные в EXCROLES

## Запуск бота

### Вне docker 

Для запуска бота не из докера требуется python версии 3.8+.
1. Установить зависимости из файла requirements.txt командой:  pip3 install 
2. Запустить исполняемый файл bot/main.py командой python3

### Из docker

1. Создать image на основе Dockerfile 
```
docker build --tag <imagename>:<tag> ./path/to/dir/with/Dockerfile
```
2. Запустить container на основе собранного image 
```
docker run --name <conteinername> <imagename>:<tag>
```
## Использование бота

### Для работы первой функции бота требуется:

1. Создать канал с закрытыми правами для создания сообщений, сообщений в ветках и добавления реакций
2. Оставить на выбранном посте все реакции которые бот должен отследить

### Для работы второй функции бота требуется: 
1. Создать канал, который бот будет слушать для команды удаления 

Для удаления в созданном канале пользователи с ролями из PRIVROLES должны оставить сообщение вида DELETE_COMAND ROLE_NAME
ПРИМЕР: 
```
DELETE_COMAND = “/delete”
```
Сообщение в чате для удаления пользователей с ролью NEW: /delete NEW

### Для работы третьей функции бота требуется: 

1. Создать роль, которую бот будет назначать при вхождении пользователя на сервер.
